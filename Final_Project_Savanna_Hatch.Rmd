---
title: "Final Project"
author: "Savanna Hatch"
date: "`r Sys.Date()`"
output:
  github_document:
    toc: true
---

```{r setup and data, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

asthma_data <- data.frame(
  state = c("Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut",
            "Delaware","District of Columbia","Florida","Georgia","Hawaii","Idaho","Illinois",
            "Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts",
            "Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada",
            "New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota",
            "Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina",
            "South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington",
            "West Virginia","Wisconsin","Wyoming"),
  
  state_abrv = c("AL","AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA", "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA", "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY", "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX", "UT", "VT", "VA", "WA", "WV", "WI", "WY"),
  
  number = c(378702,58742,555997,243032,2629546,500090,356651,
             78980,60410,1646583,802783,103228,161970,856488,
             574447,238689,237705,377365,351940,146031,499134,633126,
             935666,434473,211055,497216,102617,121412,251193,
             148330,644536,171212,1611027,764909,61944,
             1042354,373879,389831,1033741,117252,368883,
             56630,636322,1760654,266105,68112,671051,667228,
             181395,503318,46973),
  
  prevalence_raw = c("9.6 (0.59)","10.7 (0.58)","9.7 (0.49)","10.5 (0.57)","8.7 (0.39)","10.8 (0.43)","12.4 (0.51)",
                     "9.9 (0.64)","11.1 (0.77)","9.3 (0.53)","9.6 (0.48)","9.1 (0.45)","11.1 (0.51)","8.7 (0.58)",
                     "11.0 (0.39)","9.7 (0.42)","10.7 (0.41)","10.8 (0.68)","10.0 (0.55)","13.1 (0.52)","10.4 (0.38)","11.3 (0.43)",
                     "11.9 (0.44)","9.9 (0.32)","9.4 (0.63)","10.4 (0.49)","11.7 (0.51)","8.1 (0.46)","10.1 (0.79)",
                     "13.1 (0.64)","8.9 (0.43)","10.4 (0.62)","10.3 (0.34)","9.2 (0.62)","10.4 (0.60)",
                     "11.4 (0.38)","12.3 (0.54)","11.5 (0.51)","10.1 (0.67)","13.3 (0.64)","9.0 (0.40)",
                     "8.3 (0.75)","11.7 (0.61)","7.9 (0.37)","11.0 (0.43)","12.9 (0.53)","9.9 (0.46)","10.9 (0.26)",
                     "12.9 (0.61)","10.9 (0.42)","10.5 (0.65)"), 
  
  population = c(5108468, 733406, 7431344, 3067732, 38965193, 5877610, 3617176, 1031890, 678972,
  22610726, 11029227, 1435138, 1964726, 12549689, 6862199, 3207004, 2940546,
  4526154, 4573749, 1395722, 6180253, 7001399, 10037261, 5737915, 2939690,
  6196156, 1132812, 1978379, 3194176, 1402054, 9290842, 2114371, 19571216,
  10835491, 783926, 11785935, 4053824, 4233358, 12961683, 1095962, 5373555,
  919318, 7126489, 30503301, 3417735, 647464, 8715698, 7812880, 1770071,
  5910955, 584057),
  
   pop_density_sqmile = c(101,1.3,65,59,250,57,747,529,11131,422,192,223,24,226,192,57,36,115,106,45,637,898,178,72,63,90,7.8,26,29,157,1263,17,415,223,11,274,59,44,290,1060,179,12,173,117,42,70,221,118,74,109,6)
)

library(dplyr)
library(stringr)

asthma_data <- asthma_data %>%
  mutate(
    prevalence = as.numeric(str_extract(prevalence_raw, "^[0-9.]+")),
    SE = as.numeric(str_extract(prevalence_raw, "(?<=\\().+?(?=\\))")),
    state_lower = tolower(state),
    region = state.region[match(state, state.name)]
  )

asthma_data <- na.omit(asthma_data)


library(ggplot2)
library(maps)
library(dplyr)

# Map data
states_map <- map_data("state")

# Merge map data with asthma data
map_data <- states_map %>%
  left_join(asthma_data, by = c("region" = "state_lower"))

```


# ABSTRACT


# BACKGROUND
Asthma is a chronic disease, presented as inflammation in the lungs and airways, that typically shows symptoms such as coughing, shortness of breath, tightness in the chest, and wheezing (Sockrider & Fussner, 2020). It also involves remodeling of the airway. This is seen in the thickening of the airway walls (Elias et. al, 1999). There are many different triggers that can lead to asthmatic symptoms.  These triggers include things such as strong odors, chemicals, dust, and allergens (Win and Hussain, 2009). Asthma, along with other allergic diseases has become more prevalent as urbanization has increased (Kudo et. al, 2013). In many areas that are experiencing rapid urbanization and westernization, asthma prevalence has also increased (Paciência and Cavaleiro, 2020).  This paper focuses on the impact of higher population densities in urbanized areas on the asthma prevalence within that population.

# STUDY QUESTION and HYPOTHESIS

## Questions  
Does the rate of asthma increase in areas with higher population densities?

## Hypothesis 
Areas or states with a higher population density per square mile will have a higher prevalence of asthma.

## Prediction
Smaller states that have high populations will have a higher prevalance of asthma, and larger states with low populations will have lower prevalance of asthma.

# METHODS
Recent asthma data was collected from the Center for Disease Control (CDC) as well as the current population number and population density for each state.  Data was organized both by state and by region.  Regions consisted of West, South, Northeast, and North Central United States (Figure 1).  Asthma Prevalence was compared between states using a bar graph (Figure 2) and a map visualization (Figure 3), and then between states in relation to the overall state population (Figure 4).  Asthma Prevalence was also compared between state by Population Density per Square Mile (Figure 5), and then it was compared between region (Figure 6).  An ANOVA test was performed to determine whether there was a significant relation between individual state Population Density and Asthma Prevalence.  A second ANOVA test was run to determine if there was a significant relation between U.S. Region and Asthma Prevalence.  A Tukey pairwise comparison was performed to show which, if any, region had a significant difference from the others in the Region and Asthma Prevalence relationship. 

```{r regions by color}
#just regions
# Get U.S. states map data
states_map <- map_data("state")

# Create a dataframe of states and their regions
state_regions <- data.frame(
  state = tolower(state.name),
  region = state.region
)

# Merge map data with region info
map_data <- states_map %>%
  left_join(state_regions, by = c("region" = "state"))

# Plot
ggplot(map_data, aes(x = long, y = lat, group = group, fill = region.y)) +
  geom_polygon(color = "white") +
  coord_fixed(1.3) +
  labs(title = "Four U.S. Census Regions",
       fill = "Region") +
  theme_void()
```
Figure 1: The U.S. divided into four regions: West, South, Northeast, and North Central.

```{r bar graph, echo=FALSE, message=FALSE, warning=FALSE, fig.height=10, fig.width=7}

# Load required libraries

library(tidyverse)

# Create the plot

ggplot(asthma_data, aes(x = reorder(state, prevalence), y = prevalence, fill= region)) +
  geom_col() +
  geom_errorbar(aes(ymin = prevalence - SE, ymax = prevalence + SE), width = 0.3) +
  coord_flip() +
  labs(
    title = "Asthma Rates by State ",
    x = "State",
    y = "Rate (%)",
    fill = "Region") +
  theme_minimal(base_size = 12) +
  theme(
    axis.text.y = element_text(size = 10, margin = margin(r = 5)),
    plot.margin = margin(10, 15, 10, 15))

```
Fidure 2: This figure shows the Asthma Prevalence percentages per U.S. state.

```{r prevalence by state, include=TRUE, eval=TRUE, warning=FALSE, fig.align='center', fig.width=6, fig.height=3}

library(ggplot2)
library(maps)
library(dplyr)

# Map data
states_map <- map_data("state")

# Merge map data with asthma data
map_data <- states_map %>%
  left_join(asthma_data, by = c("region" = "state_lower"))

ggplot(map_data, aes(long, lat, group = group, fill = prevalence)) +
  geom_polygon(color = "gray90", size = 0.3) +  # state borders
  geom_polygon(aes(fill = prevalence), color = "white") +
  coord_fixed(1.3) +
 scale_fill_gradientn(
  name = "Asthma Prevalence (%)",
  colors = c("yellow2", "orange", "red", "red4")
) +
  labs(
    title = "Asthma Prevalence by U.S. State",
  ) +
  theme_void() +
  theme(
    legend.position = "right",
    plot.title = element_text(size = 16, face = "bold"),
    plot.subtitle = element_text(size = 12)
  )

```
Figure 3: This figure shows the prevalence of asthma by state with higher rates of asthma shown in darker colors.

```{r scatter plot, include=TRUE, eval=TRUE, warning=FALSE, fig.align='center'}

ggplot(asthma_data, aes(x = population, y = prevalence)) +
  geom_point(aes(color=region)) +
  geom_text(aes(label = state_abrv), vjust = -0.5, size = 3)+
  labs(title = "Population vs. Asthma Prevalence by State",
       x = "Population",
       y = "Asthma Prevalence (%)",
       color = "Regions") +
  theme_minimal()
```
Figure 4: This figure shows the comparison by state of Population to Asthma Prevalence

```{r pop density graph, include=TRUE, eval=TRUE, warning=FALSE, fig.align='center', fig.width=12, fig.height=6}

# Load libraries
library(ggplot2)

# Create plot
ggplot(asthma_data, aes(x = pop_density_sqmile, y = prevalence, colour = region)) +
  geom_point() +
  theme_minimal() +
  labs(title = "Population Density vs Asthma Prevalence by State", x = 'Population Per Square Mile', y = 'Percent With Current Asthma', colour = "Region") 

```
Figure 5: This plot shows the comparison by state of Population Density (per square mile) to Asthma Prevalence (Percent With Current Asthma)

```{r box plot, include=TRUE, eval=TRUE, warning=FALSE, fig.align='center', fig.width=4.75, fig.height=7}

library(ggplot2)

ggplot(asthma_data, aes(x = region, y = prevalence, fill= region)) +
  geom_boxplot() +
  labs(title = "Asthma Prevalence by U.S. Region",
       x = "Region",
       y = "Asthma Prevalence (%)",
       fill = "Region") +
  theme_minimal()

```
Figure 6: This figure shows the comparison of Asthma Prevalence between regions.

```{r first analysis ANOVA for state population density and asthma prevalence, eval=FALSE}

# load necessary libraries

library("car")
library("lme4")

# create a linear model for population density per square mile and asthma prevalence by state

m1 <- lm(prevalence ~ pop_density_sqmile, data=asthma_data)

# perform statistical test

Anova(m1)
summary(m1)

```


```{r second analysis ANOVA by region and pairwise comparison, eval= FALSE}

# load necessary libraries

library(emmeans)

# create a linear model for US region and asthma prevalence

m2 <- lm(prevalence ~ region, data=asthma_data) 

# perform statistical test 

Anova(m2) 
summary(m2)



# pairwise comparison

pairs(emmeans(m2, "region"))

```


# DISCUSSION
When comparing Asthma Prevalence between U.S. regions, it was found that the Northeast region had a significant difference in Asthma rates. An ANOVA test resulted in a p-value of 0.0192 showing a slight statistical significance in at least one of the regions.  This means that the Asthma Prevalence percentage can be predicted using population density in the significant regions.  A Tukey pairwise comparison showed that all regions were significantly lower than the Northeast region with p-values of 0.00419 for the South, 0.00558 for the North Central, and 0.02671 for the West region.
When comparing Asthma Prevalence between U.S. states, it was found that there was no statistical significance in Asthma Prevalence when comparing Population Density per Square Mile.  This ANOVA test resulted in a p-value of 0.6668.  There was no evidence to show that asthma rates increase with higher population densities.

# CONCLUSION
Asthma is a chronic respiratory disease that is not predictable according to population or population density.  It is somewhat predictable according to U.S. region.  The Northeast region of the U.S. is a significant predictor of Asthma Prevalence in the states included in that region.  It is possible that future studies with increased data may show more significance in other U.S. regions that could lead to predictors other than the Northeast region of Asthma Prevalence rates.

# REFERENCES     
1. Asthma and Allergy Foundation of America. (n.d.). Air pollution and asthma. Asthma & Allergy Foundation of America. https://aafa.org/asthma/asthma-triggers-causes/air-pollution-smog-asthma/

2. Centers for Disease Control and Prevention. (2024, November 21). Most recent asthma data. U.S. Department of Health and Human Services. https://www.cdc.gov/asthma-data/about/most-recent-asthma-data.html

3. ChatGPT. OpenAI, version Jan 2025. Used as a reference for functions
    such as ggplot(), creating the map and troubleshooting error messages. Accessed 2025-11-10.

4. Elias, J. A., Zhu, Z., Chupp, G., & Homer, R. J. (1999, October 15). Airway remodeling in asthma. The Journal of Clinical Investigation. https://www.jci.org/articles/view/8124?..

5. Kudo, M., Ishigatsubo, Y., & Aoki, I. (2013, September 9). Pathology of asthma. Frontiers. https://www.frontiersin.org/journals/microbiology/articles/10.3389/fmicb.2013.00263/full 

6. National Heart, Lung, and Blood Institute. (2025). Asthma. U.S. Department of Health and Human Services. https://www.nhlbi.nih.gov/health/asthma

7. Paciência, I., & Cavaleiro Rufo, J. (2020). Urban-level environmental factors related to pediatric asthm... : Porto Biomedical Journal. https://journals.lww.com/pbj/FullText/2020/02000/Urban_level_environmental_factors_related_to.2.aspx

8. Sockrider, M., & Fussner, L. (2020). What is asthma? | American Journal of Respiratory and Critical Care Medicine. https://www.atsjournals.org/doi/10.1164/rccm.2029P25 

9. Win, P. H., & Hussain, I. (2009, May 22). Asthma triggers: What really matters?. Clinical Asthma. https://pmc.ncbi.nlm.nih.gov/articles/PMC7152189/
